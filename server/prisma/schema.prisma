generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "sqlserver"
  url      = env("DATABASE_URL")
}

model TaiKhoan {
  MaTK         Int       @id(map: "PK__TaiKhoan__272500704A83CB72") @default(autoincrement())
  TenDangNhap  String    @unique(map: "UQ__TaiKhoan__55F68FC002779937") @db.VarChar(50)
  MatKhauMaHoa String    @db.VarChar(255)
  VaiTro       Int       @db.TinyInt
  TrangThai    Int       @default(1, map: "DF__TaiKhoan__TrangT__38996AB5") @db.TinyInt
  Admin        Admin?
  DocGia       DocGia?
  NhanVien     NhanVien?
}

model Admin {
  MaTK        Int       @id(map: "PK__Admin__27250070C334600A")
  HoTen       String    @db.NVarChar(50)
  NgaySinh    DateTime? @db.Date
  Email       String?   @unique(map: "UQ__Admin__A9D10534F7994045") @db.VarChar(50)
  SoDienThoai String?   @unique(map: "UQ__Admin__0389B7BD185C3EEA") @db.VarChar(20)
  TaiKhoan    TaiKhoan  @relation(fields: [MaTK], references: [MaTK], onDelete: Cascade, onUpdate: NoAction, map: "FK_Admin_TaiKhoan")
}

model NhanVien {
  IdNV        Int          @id(map: "PK__NhanVien__B773C9702F5EF8D4") @default(autoincrement())
  MaTK        Int          @unique(map: "UQ__NhanVien__272500717C91E5A3")
  MaNV        String?      @db.VarChar(50)
  HoTen       String       @db.NVarChar(50)
  NgaySinh    DateTime?    @db.Date
  Email       String?      @unique(map: "UQ__NhanVien__A9D10534D32DBD63") @db.VarChar(50)
  SoDienThoai String?      @unique(map: "UQ__NhanVien__0389B7BD04D4141D") @db.VarChar(20)
  DiaChi      String?      @db.NVarChar(255)
  ChucVu      String?      @db.NVarChar(50)
  TaiKhoan    TaiKhoan     @relation(fields: [MaTK], references: [MaTK], onDelete: Cascade, onUpdate: NoAction, map: "FK_NhanVien_TaiKhoan")
  PhieuMuon   PhieuMuon[]
  TraSach     TraSach[]
  YeuCauMuon  YeuCauMuon[]
}

model DocGia {
  IdDG        Int          @id(map: "PK__DocGia__B77398A55A216422") @default(autoincrement())
  MaTK        Int          @unique(map: "UQ__DocGia__27250071DE84AC3A")
  MaDG        String?      @db.VarChar(50)
  HoTen       String       @db.NVarChar(50)
  NgaySinh    DateTime?    @db.Date
  DiaChi      String?      @db.NVarChar(255)
  Email       String?      @unique(map: "UQ__DocGia__A9D10534D9621E8F") @db.VarChar(50)
  SoDienThoai String?      @unique(map: "UQ__DocGia__0389B7BDB06B5117") @db.VarChar(20)
  NgayDangKy  DateTime     @default(now(), map: "DF__DocGia__NgayDang__4BAC3F29") @db.Date
  NgayHetHan  DateTime     @db.Date
  TrangThai   String       @db.VarChar(50)
  TaiKhoan    TaiKhoan     @relation(fields: [MaTK], references: [MaTK], onDelete: Cascade, onUpdate: NoAction, map: "FK_DocGia_TaiKhoan")
  PhieuMuon   PhieuMuon[]
  YeuCauMuon  YeuCauMuon[]
}

model TacGia {
  MaTG        Int           @id(map: "PK__TacGia__2725007458AF22EF") @default(autoincrement())
  TenTacGia   String        @db.NVarChar(100)
  TieuSu      String?       @db.NVarChar(Max)
  QuocTich    String?       @db.NVarChar(50)
  Sach_TacGia Sach_TacGia[]
}

model TheLoai {
  MaTL         Int            @id(map: "PK__TheLoai__27250071FB52A0AF") @default(autoincrement())
  TenTheLoai   String         @unique(map: "UQ__TheLoai__327F958F34C83368") @db.NVarChar(100)
  MoTa         String?        @db.NVarChar(Max)
  Sach_TheLoai Sach_TheLoai[]
}

model NhaXuatBan {
  MaNXB       Int     @id(map: "PK__NhaXuatB__3A19482C5FF6823A") @default(autoincrement())
  TenNXB      String  @unique(map: "UQ__NhaXuatB__CCE3868DE351381A") @db.NVarChar(255)
  DiaChi      String? @db.NVarChar(255)
  SoDienThoai String? @db.VarChar(20)
  Email       String? @db.VarChar(50)
  Sach        Sach[]
}

model Sach {
  MaSach       Int            @id(map: "PK__Sach__B235742D4206580F") @default(autoincrement())
  TieuDe       String         @db.NVarChar(255)
  NamXuatBan   Int?
  GiaSach      Float          @default(0, map: "DF__Sach__GiaSach__5812160E")
  MaNXB        Int?
  SoLuong      Int            @default(0, map: "DF__Sach__SoLuong__59063A47")
  ViTriKe      String?        @db.NVarChar(50)
  TrangThai    String         @db.VarChar(50)
  AnhBia       String?        @db.NVarChar(Max)
  CuonSach     CuonSach[]
  NhaXuatBan   NhaXuatBan?    @relation(fields: [MaNXB], references: [MaNXB], onDelete: NoAction, onUpdate: NoAction, map: "FK_Sach_NXB")
  Sach_TacGia  Sach_TacGia[]
  Sach_TheLoai Sach_TheLoai[]
}

model CuonSach {
  MaCuonSach     Int              @id(map: "PK__CuonSach__A00E686D858E7583") @default(autoincrement())
  MaSach         Int
  TrangThaiCS    String           @db.VarChar(50)
  ChiTietMuon    ChiTietMuon[]
  ChiTietTraSach ChiTietTraSach[]
  Sach           Sach             @relation(fields: [MaSach], references: [MaSach], onUpdate: NoAction, map: "FK_CuonSach_Sach")
  ThePhat        ThePhat[]
  YeuCauMuon     YeuCauMuon[]
}

model Sach_TacGia {
  MaSach Int
  MaTG   Int
  VaiTro String? @db.NVarChar(50)
  Sach   Sach    @relation(fields: [MaSach], references: [MaSach], onUpdate: NoAction, map: "FK_STG_Sach")
  TacGia TacGia  @relation(fields: [MaTG], references: [MaTG], onUpdate: NoAction, map: "FK_STG_TacGia")

  @@id([MaSach, MaTG], map: "PK__Sach_Tac__E047242A9582CC20")
}

model Sach_TheLoai {
  MaSach  Int
  MaTL    Int
  Sach    Sach    @relation(fields: [MaSach], references: [MaSach], onUpdate: NoAction, map: "FK_STL_Sach")
  TheLoai TheLoai @relation(fields: [MaTL], references: [MaTL], onUpdate: NoAction, map: "FK_STL_TheLoai")

  @@id([MaSach, MaTL], map: "PK__Sach_The__B047242AAB7146A1")
}

model PhieuMuon {
  MaPM        Int           @id(map: "PK__PhieuMuo__2725E7FF23FAF3A6") @default(autoincrement())
  IdDG        Int
  IdNV        Int
  ChiTietMuon ChiTietMuon[]
  DocGia      DocGia        @relation(fields: [IdDG], references: [IdDG], onUpdate: NoAction, map: "FK_PM_DocGia")
  NhanVien    NhanVien      @relation(fields: [IdNV], references: [IdNV], onUpdate: NoAction, map: "FK_PM_NhanVien")
  TraSach     TraSach[]
}

model ChiTietMuon {
  MaPM        Int
  MaCuonSach  Int
  NgayMuon    DateTime  @db.Date
  NgayHenTra  DateTime  @db.Date
  NgayTra     DateTime? @db.Date
  TrangThai   String    @db.VarChar(50)
  SoLanGiaHan Int       @default(0, map: "DF__ChiTietMu__SoLan__6EF57B66")
  CuonSach    CuonSach  @relation(fields: [MaCuonSach], references: [MaCuonSach], onUpdate: NoAction, map: "FK_CTM_CuonSach")
  PhieuMuon   PhieuMuon @relation(fields: [MaPM], references: [MaPM], onUpdate: NoAction, map: "FK_CTM_PM")

  @@id([MaPM, MaCuonSach], map: "PK__ChiTietM__ED250179ED265FB5")
}

model TraSach {
  MaTraSach      Int              @id(map: "PK__TraSach__A136C95F32A0FE38") @default(autoincrement())
  MaPM           Int
  IdNV           Int?
  NgayTra        DateTime         @db.Date
  GhiChu         String?          @db.NVarChar(255)
  DaThongBao     Boolean          @default(false, map: "DF__TraSach__DaThong__7A672E12")
  ChiTietTraSach ChiTietTraSach[]
  ThePhat        ThePhat[]
  NhanVien       NhanVien?        @relation(fields: [IdNV], references: [IdNV], onDelete: NoAction, onUpdate: NoAction, map: "FK_TraSach_NV")
  PhieuMuon      PhieuMuon        @relation(fields: [MaPM], references: [MaPM], onDelete: Cascade, onUpdate: NoAction, map: "FK_TraSach_PM")
}

model ChiTietTraSach {
  MaTraSach     Int
  MaCuonSach    Int
  ChatLuongSach String   @db.VarChar(20)
  CuonSach      CuonSach @relation(fields: [MaCuonSach], references: [MaCuonSach], onDelete: Cascade, onUpdate: NoAction, map: "FK_CTTra_CuonSach")
  TraSach       TraSach  @relation(fields: [MaTraSach], references: [MaTraSach], onDelete: Cascade, onUpdate: NoAction, map: "FK_CTTra_TraSach")

  @@id([MaTraSach, MaCuonSach], map: "PK__ChiTietT__6B362FD9D620B832")
}

model ThePhat {
  MaPhat             Int       @id(map: "PK__ThePhat__4AC072E2A26DDF8D") @default(autoincrement())
  MaTraSach          Int
  MaCuonSach         Int
  SoTienPhat         Decimal   @db.Decimal(10, 2)
  LyDoPhat           String    @db.NVarChar(20)
  TrangThaiThanhToan String    @db.VarChar(20)
  NgayThanhToan      DateTime? @db.Date
  GhiChu             String?   @db.NVarChar(255)
  CuonSach           CuonSach  @relation(fields: [MaCuonSach], references: [MaCuonSach], onDelete: Cascade, onUpdate: NoAction, map: "FK_ThePhat_CuonSach")
  TraSach            TraSach   @relation(fields: [MaTraSach], references: [MaTraSach], onDelete: Cascade, onUpdate: NoAction, map: "FK_ThePhat_TraSach")
}

model CauHinhHeThong {
  MaCH         Int      @id(map: "PK__CauHinhH__27258E00490CE391") @default(autoincrement())
  Nhom         String   @db.NVarChar(50)
  TenThamSo    String   @db.NVarChar(100)
  GiaTri       String   @db.NVarChar(255)
  KieuDuLieu   String   @db.NVarChar(50)
  MoTa         String?  @db.NVarChar(255)
  NgayCapNhat  DateTime @default(now(), map: "DF__CauHinhHe__NgayC__0B91BA14") @db.DateTime
  NguoiCapNhat String?  @db.NVarChar(50)

  @@unique([Nhom, TenThamSo], map: "UQ_CauHinh")
}

model YeuCauMuon {
  MaYeuCau   Int       @id(map: "PK__YeuCauMu__CFA5DF4E14057920") @default(autoincrement())
  IdDG       Int
  MaCuonSach Int
  NgayYeuCau DateTime  @default(now(), map: "DF__YeuCauMuo__NgayY__73BA3083") @db.DateTime
  NgayHenTra DateTime  @db.Date
  TrangThai  String    @db.VarChar(20)
  LyDoTuChoi String?   @db.NVarChar(255)
  IdNVXuLy   Int?
  NgayXuLy   DateTime? @db.DateTime
  GhiChu     String?   @db.NVarChar(255)
  CuonSach   CuonSach  @relation(fields: [MaCuonSach], references: [MaCuonSach], onUpdate: NoAction, map: "FK_YeuCauMuon_CuonSach")
  DocGia     DocGia    @relation(fields: [IdDG], references: [IdDG], onUpdate: NoAction, map: "FK_YeuCauMuon_DocGia")
  NhanVien   NhanVien? @relation(fields: [IdNVXuLy], references: [IdNV], onDelete: NoAction, onUpdate: NoAction, map: "FK_YeuCauMuon_NhanVien")
}
