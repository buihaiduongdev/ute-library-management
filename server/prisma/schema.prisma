generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "sqlserver"
  url      = env("DATABASE_URL")
}

model TaiKhoan {
  MaTK         Int       @id @default(autoincrement())
  TenDangNhap  String    @unique
  MatKhauMaHoa String    @db.VarChar(255)
  VaiTro       Int       @db.TinyInt
  TrangThai    Int       @default(1) @db.TinyInt
  Admin        Admin?
  DocGia       DocGia?
  NhanVien     NhanVien?
}

model Admin {
  MaTK        Int       @id
  HoTen       String    @db.NVarChar(50)
  NgaySinh    DateTime? @db.Date
  Email       String?   @unique
  SoDienThoai String?   @unique
  TaiKhoan    TaiKhoan  @relation(fields: [MaTK], references: [MaTK], onDelete: Cascade, map: "FK_Admin_TaiKhoan")
}

model NhanVien {
  IdNV        Int         @id @default(autoincrement())
  MaTK        Int         @unique
  MaNV        String?     @unique
  HoTen       String      @db.NVarChar(50)
  NgaySinh    DateTime?   @db.Date
  Email       String?     @unique
  SoDienThoai String?     @unique
  DiaChi      String?     @db.NVarChar(255)
  ChucVu      String?     @db.NVarChar(50)
  TaiKhoan    TaiKhoan    @relation(fields: [MaTK], references: [MaTK], onDelete: Cascade, map: "FK_NhanVien_TaiKhoan")
  PhieuMuon   PhieuMuon[]
  TraSach     TraSach[]
}

model DocGia {
  IdDG        Int         @id @default(autoincrement())
  MaTK        Int         @unique
  MaDG        String?     @unique
  HoTen       String      @db.NVarChar(50)
  NgaySinh    DateTime?   @db.Date
  DiaChi      String?     @db.NVarChar(255)
  Email       String?     @unique
  SoDienThoai String?     @unique
  NgayDangKy  DateTime    @default(now(), map: "DF__DocGia__NgayDang__4AB81AF0") @db.Date
  NgayHetHan  DateTime    @db.Date
  TrangThai   String      @db.VarChar(50)
  TaiKhoan    TaiKhoan    @relation(fields: [MaTK], references: [MaTK], onDelete: Cascade, map: "FK_DocGia_TaiKhoan")
  PhieuMuon   PhieuMuon[]
}

model TacGia {
  MaTG        Int           @id(map: "PK__TacGia__272500744BF15A78") @default(autoincrement())
  TenTacGia   String        @db.NVarChar(100)
  TieuSu      String?       @db.NVarChar(Max)
  QuocTich    String?       @db.NVarChar(50)
  Sach_TacGia Sach_TacGia[]
}

model TheLoai {
  MaTL         Int            @id(map: "PK__TheLoai__27250071519B73FF") @default(autoincrement())
  TenTheLoai   String         @unique(map: "UQ__TheLoai__327F958F4C70B6F7") @db.NVarChar(100)
  MoTa         String?        @db.NVarChar(Max)
  Sach_TheLoai Sach_TheLoai[]
}

model NhaXuatBan {
  MaNXB       Int     @id(map: "PK__NhaXuatB__3A19482C90BC9455") @default(autoincrement())
  TenNXB      String  @unique(map: "UQ__NhaXuatB__CCE3868DA901E70A") @db.NVarChar(255)
  DiaChi      String? @db.NVarChar(255)
  SoDienThoai String? @db.VarChar(20)
  Email       String? @db.VarChar(50)
  Sach        Sach[]
}

model Sach {
  MaSach       Int            @id(map: "PK__Sach__B235742D8CE51893") @default(autoincrement())
  TieuDe       String         @db.NVarChar(255)
  NamXuatBan   Int?
  GiaSach      Decimal        @default(0, map: "DF__Sach__GiaSach__367C1819") @db.Decimal(10, 2)
  MaNXB        Int?
  SoLuong      Int            @default(0, map: "DF__Sach__SoLuong__37703C52")
  ViTriKe      String?        @db.NVarChar(50)
  TrangThai    String         @db.VarChar(50)
  AnhBia       Bytes?
  CuonSach     CuonSach[]
  NhaXuatBan   NhaXuatBan?    @relation(fields: [MaNXB], references: [MaNXB], onDelete: NoAction, onUpdate: NoAction, map: "FK_Sach_NXB")
  Sach_TacGia  Sach_TacGia[]
  Sach_TheLoai Sach_TheLoai[]
}

model CuonSach {
  MaCuonSach     Int              @id(map: "PK__CuonSach__A00E686DB35FEE84") @default(autoincrement())
  MaSach         Int
  TrangThaiCS    String           @db.VarChar(50)
  ChiTietMuon    ChiTietMuon[]
  ChiTietTraSach ChiTietTraSach[]
  Sach           Sach             @relation(fields: [MaSach], references: [MaSach], onUpdate: NoAction, map: "FK_CuonSach_Sach")
  ThePhat        ThePhat[]
}

model Sach_TacGia {
  MaSach Int
  MaTG   Int
  VaiTro String? @db.NVarChar(50)
  Sach   Sach    @relation(fields: [MaSach], references: [MaSach], onUpdate: NoAction, map: "FK_STG_Sach")
  TacGia TacGia  @relation(fields: [MaTG], references: [MaTG], onUpdate: NoAction, map: "FK_STG_TacGia")

  @@id([MaSach, MaTG], map: "PK__Sach_Tac__E047242A393CCE5D")
}

model Sach_TheLoai {
  MaSach  Int
  MaTL    Int
  Sach    Sach    @relation(fields: [MaSach], references: [MaSach], onUpdate: NoAction, map: "FK_STL_Sach")
  TheLoai TheLoai @relation(fields: [MaTL], references: [MaTL], onUpdate: NoAction, map: "FK_STL_TheLoai")

  @@id([MaSach, MaTL], map: "PK__Sach_The__B047242AE081EB12")
}

model PhieuMuon {
  MaPM        Int           @id(map: "PK__PhieuMuo__2725E7FF99CB9197") @default(autoincrement())
  IdDG        Int
  IdNV        Int
  ChiTietMuon ChiTietMuon[]
  DocGia      DocGia        @relation(fields: [IdDG], references: [IdDG], onUpdate: NoAction, map: "FK_PM_DocGia")
  NhanVien    NhanVien      @relation(fields: [IdNV], references: [IdNV], onUpdate: NoAction, map: "FK_PM_NhanVien")
  TraSach     TraSach[]
}

model ChiTietMuon {
  MaPM       Int
  MaCuonSach Int
  NgayMuon   DateTime  @db.Date
  NgayHenTra DateTime  @db.Date
  NgayTra    DateTime? @db.Date
  TrangThai  String    @db.VarChar(50)
  CuonSach   CuonSach  @relation(fields: [MaCuonSach], references: [MaCuonSach], onUpdate: NoAction, map: "FK_CTM_CuonSach")
  PhieuMuon  PhieuMuon @relation(fields: [MaPM], references: [MaPM], onUpdate: NoAction, map: "FK_CTM_PM")

  @@id([MaPM, MaCuonSach], map: "PK__ChiTietM__ED250179F2F07524")
}

model TraSach {
  MaTraSach      Int              @id(map: "PK__TraSach__A136C95F5BFA2F73") @default(autoincrement())
  MaPM           Int
  IdNV           Int?
  NgayTra        DateTime         @db.Date
  GhiChu         String?          @db.NVarChar(255)
  DaThongBao     Boolean          @default(false, map: "DF__TraSach__DaThong__51300E55")
  ChiTietTraSach ChiTietTraSach[]
  ThePhat        ThePhat[]
  NhanVien       NhanVien?        @relation(fields: [IdNV], references: [IdNV], onUpdate: NoAction, map: "FK_TraSach_NV")
  PhieuMuon      PhieuMuon        @relation(fields: [MaPM], references: [MaPM], onDelete: Cascade, onUpdate: NoAction, map: "FK_TraSach_PM")
}

model ChiTietTraSach {
  MaTraSach     Int
  MaCuonSach    Int
  ChatLuongSach String   @db.VarChar(20)
  CuonSach      CuonSach @relation(fields: [MaCuonSach], references: [MaCuonSach], onDelete: Cascade, onUpdate: NoAction, map: "FK_CTTra_CuonSach")
  TraSach       TraSach  @relation(fields: [MaTraSach], references: [MaTraSach], onDelete: Cascade, onUpdate: NoAction, map: "FK_CTTra_TraSach")

  @@id([MaTraSach, MaCuonSach], map: "PK__ChiTietT__6B362FD9CA41F5CE")
}

model ThePhat {
  MaPhat             Int       @id(map: "PK__ThePhat__4AC072E28F027F7A") @default(autoincrement())
  MaTraSach          Int
  MaCuonSach         Int
  SoTienPhat         Decimal   @db.Decimal(10, 2)
  LyDoPhat           String    @db.NVarChar(20)
  TrangThaiThanhToan String    @db.VarChar(20)
  NgayThanhToan      DateTime? @db.Date
  GhiChu             String?   @db.NVarChar(255)
  CuonSach           CuonSach  @relation(fields: [MaCuonSach], references: [MaCuonSach], onDelete: Cascade, onUpdate: NoAction, map: "FK_ThePhat_CuonSach")
  TraSach            TraSach   @relation(fields: [MaTraSach], references: [MaTraSach], onDelete: Cascade, onUpdate: NoAction, map: "FK_ThePhat_TraSach")
}

model CauHinhHeThong {
  MaCH         Int      @id(map: "PK__CauHinhH__27258E006C305AF7") @default(autoincrement())
  Nhom         String   @db.NVarChar(50)
  TenThamSo    String   @db.NVarChar(100)
  GiaTri       String   @db.NVarChar(255)
  KieuDuLieu   String   @db.NVarChar(50)
  MoTa         String?  @db.NVarChar(255)
  NgayCapNhat  DateTime @default(now(), map: "DF__CauHinhHe__NgayC__625A9A57") @db.DateTime
  NguoiCapNhat String?  @db.NVarChar(50)

  @@unique([Nhom, TenThamSo], map: "UQ_CauHinh")
}
